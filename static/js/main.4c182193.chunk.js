(this["webpackJsonppsl-stitch-app"]=this["webpackJsonppsl-stitch-app"]||[]).push([[0],{47:function(e,t,a){},72:function(e,t,a){"use strict";a.r(t);var c=a(37),n=a.n(c),r=(a(47),a(10)),s=a.n(r),i=a(16),l=a(17),o=a(0),u=a.n(o),d=a(73),j=a(74),b=a(38),p=a.n(b).a.create({withCredentials:!0,baseURL:"http://localhost:5000"}),h=a(1),v=function(){var e=u.a.useState(),t=Object(l.a)(e,2),a=t[0],c=t[1],n=Object(o.useCallback)(Object(i.a)(s.a.mark((function e(){var t,a;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,p.get("/connect/");case 3:t=e.sent,a=t.data,console.log("got data",a),c(a),e.next=12;break;case 9:e.prev=9,e.t0=e.catch(0),console.log(e.t0);case 12:case"end":return e.stop()}}),e,null,[[0,9]])}))),[]);return Object(o.useEffect)((function(){n()}),[n]),a?Object(h.jsx)(d.a,{className:"vertical-center",children:Object(h.jsx)(j.a,{children:Object(h.jsx)("a",{href:a.authorization_uri,children:"Click this link to connect to Compute Studio"})})}):Object(h.jsx)("div",{})},x=a(75),m=a(76),O=a(18),f={policy_params:"",taxcrunch_params:"",ccc_params:"",behavior_params:""},S=function(e){var t=e.children;return Object(h.jsx)(x.a,{className:"w-100 py-3",children:Object(h.jsx)(m.a,{className:"col-auto",children:t})})},k={},w=function e(t,a,c,n){return k[t]=setTimeout(Object(i.a)(s.a.mark((function r(){var i,l,o,u,d,j,b;return s.a.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(a){r.next=2;break}return r.abrupt("return");case 2:if(!(null===(i=c)||void 0===i?void 0:i.status)||"SUCCESS"!==(null===(l=c)||void 0===l?void 0:l.status)&&"INVALID"!==(null===(o=c)||void 0===o?void 0:o.status)||(null===(u=c)||void 0===u?void 0:u.model_pk)!==a){r.next=4;break}return r.abrupt("return",clearTimeout(k[t]));case 4:return r.prev=4,r.next=7,p.get("/inputs/".concat(t,"/").concat(a,"/"));case 7:b=r.sent,n(b.data.detail),c=b.data.detail,"SUCCESS"!==(null===(d=c)||void 0===d?void 0:d.status)&&"INVALID"!==(null===(j=c)||void 0===j?void 0:j.status)?k[t]=e(t,a,c,n):clearTimeout(k[t]),r.next=16;break;case 13:r.prev=13,r.t0=r.catch(4),403===r.t0.response.status&&(window.location.href="/connect/");case 16:case"end":return r.stop()}}),r,null,[[4,13]])}))),3e3),k[t]},_={},N=function e(t,a,c,n,r){return _[t]=setTimeout(Object(i.a)(s.a.mark((function i(){var l,o,u,d,j,b,h;return s.a.wrap((function(s){for(;;)switch(s.prev=s.next){case 0:if(a){s.next=2;break}return s.abrupt("return");case 2:if(!(null===(l=n)||void 0===l?void 0:l.status)||"INVALID"!==(null===c||void 0===c?void 0:c.status)&&"SUCCESS"!==(null===(o=n)||void 0===o?void 0:o.status)&&"FAIL"!==(null===(u=n)||void 0===u?void 0:u.status)||(null===c||void 0===c?void 0:c.model_pk)!==a||(null===(d=n)||void 0===d?void 0:d.model_pk)!==a){s.next=4;break}return s.abrupt("return",clearTimeout(_[t]));case 4:return s.prev=4,s.next=7,p.get("/sim/".concat(t,"/").concat(a,"/"));case 7:if(h=s.sent,r(h.data),n=h.data,"SUCCESS"===(null===(j=n)||void 0===j?void 0:j.status)||"FAIL"===(null===(b=n)||void 0===b?void 0:b.status)){s.next=14;break}_[t]=e(t,a,c,n,r),s.next=15;break;case 14:return s.abrupt("return",clearTimeout(_[t]));case 15:s.next=20;break;case 17:s.prev=17,s.t0=s.catch(4),403===s.t0.response.status&&(window.location.href="/connect/");case 20:case"end":return s.stop()}}),i,null,[[4,17]])}))),5e3),_[t]},C=function(e){var t=e.app,a=e.model_pk,c=e.url,n=Object(o.useState)(),r=Object(l.a)(n,2),s=r[0],i=r[1],u=Object(o.useState)(),d=Object(l.a)(u,2),j=d[0],b=d[1];return Object(o.useEffect)((function(){a&&(clearTimeout(k[t]),w(t,a,s,i))}),[a]),Object(o.useEffect)((function(){a&&s&&("INVALID"!==s.status?(clearTimeout(_[t]),N(t,a,s,j,b)):clearTimeout(_[t]))}),[a,null===s||void 0===s?void 0:s.status]),Object(h.jsx)(x.a,{className:"py-2",children:Object(h.jsxs)(m.a,{children:[Object(h.jsx)("h4",{children:t}),Object(h.jsx)("h6",{children:!!j&&"".concat(j.title," by ").concat(j.owner)}),Object(h.jsx)("p",{children:c&&Object(h.jsxs)("a",{href:c,children:["ID: ",a]})}),Object(h.jsxs)("p",{children:["Inputs status: ",(null===s||void 0===s?void 0:s.status)||"STARTING"]}),Object(h.jsxs)("p",{children:["Sim status: ",(null===j||void 0===j?void 0:j.status)||"STARTING"]}),("INVALID"===(null===s||void 0===s?void 0:s.status)||(null===s||void 0===s?void 0:s.traceback))&&Object(h.jsx)("pre",{children:Object(h.jsx)("code",{children:(null===s||void 0===s?void 0:s.traceback)||JSON.stringify(s.errors_warnings,null,2)})}),"SUCCESS"===(null===j||void 0===j?void 0:j.status)&&Object(h.jsxs)("details",{children:[Object(h.jsx)("summary",{children:"API Response for Simulation"}),Object(h.jsx)("pre",{children:Object(h.jsx)("code",{children:JSON.stringify(j,null,2)})})]})]})})},I=function(){var e=u.a.useState(),t=Object(l.a)(e,2),a=(t[0],t[1]),c=u.a.useState(),n=Object(l.a)(c,2),r=n[0],d=n[1],b=Object(o.useCallback)(Object(i.a)(s.a.mark((function e(){var t,c;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,p.get("/me/");case 3:t=e.sent,"anon"===(c=t.data).status&&(window.location.href="/connect/"),a(c),e.next=13;break;case 9:e.prev=9,e.t0=e.catch(0),console.log(e.t0),403===e.t0.response.status&&(window.location.href="/connect/");case 13:case"end":return e.stop()}}),e,null,[[0,9]])}))),[]);return Object(o.useEffect)((function(){b()}),[b]),Object(h.jsxs)(j.a,{children:[Object(h.jsx)("h1",{children:"PSL Stitch"}),Object(h.jsx)(O.c,{initialValues:f,onSubmit:function(){var e=Object(i.a)(s.a.mark((function e(t,a){var c;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log({values:t,actions:a}),e.prev=1,e.next=4,p.post("/create/",t);case 4:c=e.sent,a.setStatus({invalid:null}),d(c.data),e.next=12;break;case 9:e.prev=9,e.t0=e.catch(1),a.setStatus({invalid:JSON.stringify(e.t0.response.data,null,2)});case 12:a.setSubmitting(!1);case 13:case"end":return e.stop()}}),e,null,[[1,9]])})));return function(t,a){return e.apply(this,arguments)}}(),children:function(e){return Object(h.jsxs)(h.Fragment,{children:[e.status&&e.status.invalid&&Object(h.jsx)("div",{children:Object(h.jsx)("pre",{children:Object(h.jsx)("code",{children:e.status.invalid})})}),Object(h.jsxs)(O.b,{children:[Object(h.jsxs)(S,{children:[Object(h.jsx)("label",{className:"pr-2",htmlFor:"policy_params",children:"Policy Parameters"}),Object(h.jsx)(O.a,{id:"policy_params",name:"policy_params",as:"textarea",placeholder:"{}"})]}),Object(h.jsxs)(S,{children:[Object(h.jsx)("label",{className:"pr-2",htmlFor:"taxcrunch_params",children:"Taxcrunch Parameters"}),Object(h.jsx)(O.a,{id:"taxcrunch_params",name:"taxcrunch_params",placeholder:"{}",as:"textarea"})]}),Object(h.jsxs)(S,{children:[Object(h.jsx)("label",{className:"pr-2",htmlFor:"ccc_params",children:"CCC Parameters"}),Object(h.jsx)(O.a,{id:"ccc_params",as:"textarea",name:"ccc_params",placeholder:"{}"})]}),Object(h.jsxs)(S,{children:[Object(h.jsx)("label",{className:"pr-2",htmlFor:"behavior_params",children:"Behavior Parameters"}),Object(h.jsx)(O.a,{id:"behavior_params",name:"behavior_params",placeholder:"{}",as:"textarea"})]}),Object(h.jsx)("button",{type:"submit",className:"btn btn-primary",children:"Submit"})]}),!!r&&Object(h.jsx)("div",{className:"mt-2",children:r.map((function(e){return Object(h.jsx)(C,{app:e.project,model_pk:e.model_pk,url:e.url},e.project)}))})]})}})]})},g=a(41),y=a(3);console.log("api","http://localhost:5000"),n.a.render(Object(h.jsxs)(g.a,{children:[Object(h.jsx)(y.c,{children:Object(h.jsx)(y.a,{exact:!0,path:"/connect/",render:function(){return Object(h.jsx)(v,{})}})}),Object(h.jsx)(y.c,{children:Object(h.jsx)(y.a,{exact:!0,path:"/",render:function(){return Object(h.jsx)(I,{})}})})]}),document.getElementById("root"))}},[[72,1,2]]]);
//# sourceMappingURL=main.4c182193.chunk.js.map